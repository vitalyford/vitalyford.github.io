import PageHeader from "@/components/PageHeader";

export default function ActiveIntelligenceGathering() {
  return (
    <>
      <PageHeader title="Practical Security Assessment (Penetration Testing) - Active Intelligence Gathering" />
      <br />

      <div className="lead">
        <h2 id="masscan">Masscan</h2>
        <p>
          <a href="https://github.com/robertdavidgraham/masscan">Masscan</a> a perfect tool for scanning
          humongous network ranges. But we will do it the normal way through nmap, even though nmap is
          slower than masscan when we talk about the scale.
        </p>

        <h2 id="nmap-network-mapper">NMAP - Network Mapper</h2>
        <h3 id="common-options-">Common options:</h3>
        <pre>
          <code>{`-A  # very aggressive and noisy, like a wild bear when it's awake in winter
-F  # scanning only top 100 ports
-sA # stateful port? can test firewalls but returns everything unfiltered
-sS # SYN stealthy scan
-sX # XMAS stealthy scan, good for UNIX scanning
-sI # zombie host scan, super stealthy => learn more below
-sV # service version
-sC # run default nse scripts according to -sV, learn more https://nmap.org/book/nse-usage.html
-sP # ping scan
-Pn # no ping => gotta be stealthy, and bypass firewall filtering!
-p- # scan all the ports from 0 to 65535
-n  # do not do DNS resolution, will save time
-v  # verbose mode, show all the output possible
-T(0-5) # timing, how fast you want to scan; set to 0 if paranoid (gonna be super slow)
# learn more on timing https://nmap.org/book/performance-timing-templates.html

--reason       # display why a port is in a particular state
--open         # show results for open ports only, very useful, saves time on analysis
--spoof_mac    # creates a fake MAC address to send packets from
--scan_delay   # adds a delay between probes; do not use with max_parallelism
--max_parallelism  # how many probes you want at once?
--packet-trace     # will show the packets that are sent and received

-oX # outputs results in XML
-oG # outputs results in a greppable format
-oA # outputs result in normal, grappable, and XML`}</code>
        </pre>

        <h3 id="be-stealhy-confuse-admin">Be Stealhy, Confuse Admin</h3>
        <p>
          Idle scan - put blame on zombies:{" "}
          <a href="https://nmap.org/book/idlescan.html">https://nmap.org/book/idlescan.html</a> Want to find
          zombies? Sure! Scan for 1000 random IPs to see if some of them are zombies:
        </p>
        <pre>
          <code className="language-sh">$ nmap -iR 1000 --script ipidseq -T4 -v -oA zombies</code>
        </pre>
        <p>Want to find anonymous FTP servers to store your files temporarily? (may take ~30-60 mins)</p>
        <pre>
          <code className="language-sh">$ nmap -iR 1000 --script ftp-anon -T4 -v -oA ftpAnon.txt</code>
        </pre>
        <p>Want to decoy machines on the network to confuse the admin?</p>
        <pre>
          <code className="language-sh">$ nmap -D IP_1,IP_2,IP_3,ME -p 80,21,22,25,443 -Pn REAL_TARGET_IP</code>
        </pre>

        <h3 id="other-scans">Other scans</h3>
        <pre>
          <code className="language-sh">{`$ nmap -p- -sS -n -v  --reason --open -oX demo-ports.xml 127.0.0.1
$ nmap -sU -n -v --open --reason 127.0.0.1
$ nmap -sS -sV -sC -v -n -p 21,22,80 127.0.0.1`}</code>
        </pre>

        <h3 id="nmap-scripts">Nmap scripts</h3>
        <p>
          Update: <code>$ nmap -script-updatedb</code> Learn about available scripts in nmap and where/how
          to use them <a href="https://nmap.org/book/nse.html">here</a>
        </p>

        <h3 id="use-zenmap-for-nmap-gui">Use zenmap for nmap GUI</h3>
        <p>
          Zenmap is pre-installed on Kali and is available{" "}
          <a href="https://nmap.org/download.html">here</a>
        </p>

        <h2 id="snmp-simple-network-management-protocol">SNMP - Simple Network Management Protocol</h2>
        <p>
          Let&apos;s hunt for <em>community strings</em> that are like passwords for communicating with
          devices. Fast SNMP scanner:{" "}
          <a href="https://github.com/trailofbits/onesixtyone">https://github.com/trailofbits/onesixtyone</a>
        </p>
        <pre>
          <code className="language-sh">$ onesixtyone -c dict.txt 192.168.0.1</code>
        </pre>
        <p>
          Try other dictionaries as well like{" "}
          <a href="https://github.com/fuzzdb-project/fuzzdb/blob/master/wordlists-misc/wordlist-common-snmp-community-strings.txt">
            this
          </a>
          .
        </p>
        <p>
          To have better chances in guessing community strings, try add your own ideas based on OSINT of the
          target, e.g.: <code>company_name-public or company_name-private</code>.
        </p>
        <p>In Metasploit:</p>
        <pre>
          <code className="language-sh">{`use auxiliary/scanner/snmp/snmp_enum
use auxiliary/scanner/snmp/snmp_enumshares`}</code>
        </pre>

        <h2 id="what-about-tcp-wrapped-services-">What About TCP-Wrapped Services?</h2>
        <p>
          TCP Wrapper is a host-based network access control mechanism in Unix-based systems. When we{" "}
          <code>nmap</code> a host, we will receive a response that a port is <code>tcpwrapped</code> if
          there is a TCP Wrapper or an IDS (Intrusion Detection System).
        </p>
        <p>
          There are two files that take care of it: <code>/etc/hosts.allow</code> and{" "}
          <code>/etc/hosts.deny</code>. TCP Wrapper means that we do not have the right access control
          privileges to access this particular service. It also may mean that the IDS is trying to mess with
          you and pretend to have everything TCP wrapped.
        </p>
        <p>
          If you are lucky and it is a real TCP Wrapper, then this means that your host is not allowed to
          access these ports even though they are open. If you can fake yourself to be a host that can
          access (such as <code>127.0.0.1</code>). However, if you see that a ton of ports are{" "}
          <code>tcpwrapped</code>, that may mean that you are dealing with an IDS that is messing with you.
          Try another way to check for ports, e.g. either slowing down your <code>nmap</code> scans with{" "}
          <code>-T0</code> or using <code>nc</code> command to grab banners from services.
        </p>

        <h2 id="vulnerability-scanners">Vulnerability Scanners</h2>
        <ul>
          <li>
            <a href="https://www.tenable.com/downloads/nessus">Nessus</a> is a vulnerability scanner that
            has a home and pro versions. Home version is free but limited to scanning 16 IPs.
          </li>
          <li>
            <a href="https://www.rapid7.com/products/nexpose/">Nexpose</a> is a commercial version of a
            vulnerability scanner.
          </li>
          <li>
            <a href="http://www.openvas.org/">OpenVAS</a> is an open source vulnerability scanner, good
            stuff to find low-hanging fruit.
          </li>
        </ul>

        <h2 id="responder-when-on-the-network-">Responder (when on the network)</h2>
        <ul>
          <li>
            <a href="https://github.com/SpiderLabs/Responder">Responder.py</a> is a LLMNR, NBT-NS and MDNS
            poisoner, with built-in HTTP/SMB/MSSQL/FTP/LDAP rogue authentication server supporting
            NTLMv1/NTLMv2/LMv2, Extended Security NTLMSSP and Basic HTTP authentication.
          </li>
        </ul>
        <p>
          Yep, quite a list, and I agree: a whole lot of acronyms, way too many. If you are going into
          security or IT administration, it can be useful to know what they all are.
        </p>
        <p>
          <code>Responder</code> acts as a server that &quot;knows&quot; about the network resources that
          the users request. For example, if user&apos;s machine requests something that does not exists (a
          typo), then <code>Responder</code> can reply saying that &quot;yes, I know where it is!&quot;.{" "}
          <code>Responder</code> can ask to enter the username/pass or just capture users&apos; password
          hashes without them even realizing that.
        </p>
        <p>
          Best part: it can capture NTLMv2 hashes (which later can be set on the path of cracking with
          hashcat) or even pop up a simple auth window when a user goes to a network location that cannot be
          found.
        </p>
        <ul>
          <li>
            MultiRelay is a tool that comes with Responder and it allows you to relay all that captured
            authentication info to other services on the network (targeting Admins). This means that you
            don&apos;t even need to crack the passwords, just pass them along to the known authentication
            servers and see if they let you in.
          </li>
        </ul>
        <p>
          To run the attack, you can start it with -i flag for your IP address, -b flag in Off for NTLM
          authentication, -r flag in Off so that you won&apos;t break the network:
        </p>
        <pre>
          <code className="language-sh">$ responder -i your_IP_address -b Off -r Off -w On</code>
        </pre>
        <p>
          Responder will take some time to start gathering data. When it starts gathering the data, you will
          see a lot of output in the terminal. It will poison LLMNR requests and make victims to use your
          machine as a proxy for the Internet (everything in cleartext will be visible right away). It will
          also capture NTLM hashes for you that you can try to crack with hashcat or John The Ripper.
        </p>
        <p>
          However, if the passwords are too strong, cracking those hashes will be infeasible. So, you can
          replay the SMB connections against other servers without any need to cracking the hashes (profit!).
          For that, set up <a href="https://github.com/SecureAuthCorp/impacket">Impacket Framework</a> (a
          collection of Python classes for working with network protocols). You will need to configure the
          Impacket first before actually laterally moving in the network and using captured hashes against
          other services. To configure it, follow the{" "}
          <a href="https://www.sans.org/blog/smb-relay-demystified-and-ntlmv2-pwnage-with-python/">
            SANS write-up
          </a>
          .
        </p>

        <h2 id="vulnerability-databases">Vulnerability Databases</h2>
        <ul>
          <li>
            <a href="https://vulmon.com/">Vulmon</a> is a search engine for known vulnerabilities and
            exploits
          </li>
          <li>
            <a href="https://nvd.nist.gov/vuln/search">NVD NIST</a> is a national vulnerability database
          </li>
          <li>
            <a href="https://cve.mitre.org/">CVE MITRE</a> is yet another vulnerability database
          </li>
          <li>
            <a href="https://www.exploit-db.com/">Exploit DB</a> is a database of all kinds of known
            exploits
          </li>
        </ul>

        <h2 id="advices-to-your-customers">Advices to Your Customers</h2>
        <ul>
          <li>Don&apos;t use typical names for DNS, mail, prod, dev, etc.</li>
          <li>
            <a href="https://en.wikipedia.org/wiki/Port_knocking">Port knocking</a> for the win
          </li>
          <li>
            Have a dummy service (like telnet) and if someone is trying to connect there =&gt; block that IP
          </li>
          <li>Have an IDS and IPS in place, just for the sake of it</li>
          <li>
            Change your default SNMP community strings =&gt; don&apos;t give info to the attackers
          </li>
        </ul>
      </div>
    </>
  );
}
